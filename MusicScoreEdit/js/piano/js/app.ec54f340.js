(function(e){function t(t){for(var i,n,o=t[0],r=t[1],c=t[2],l=0,p=[];l<o.length;l++)n=o[l],a[n]&&p.push(a[n][0]),a[n]=0;for(i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i]);u&&u(t);while(p.length)p.shift()();return _.push.apply(_,c||[]),s()}function s(){for(var e,t=0;t<_.length;t++){for(var s=_[t],i=!0,o=1;o<s.length;o++){var r=s[o];0!==a[r]&&(i=!1)}i&&(_.splice(t--,1),e=n(n.s=s[0]))}return e}var i={},a={app:0},_=[];function n(t){if(i[t])return i[t].exports;var s=i[t]={i:t,l:!1,exports:{}};return e[t].call(s.exports,s,s.exports,n),s.l=!0,s.exports}n.m=e,n.c=i,n.d=function(e,t,s){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:s})},n.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var s=Object.create(null);if(n.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(s,i,function(t){return e[t]}.bind(null,i));return s},n.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="";var o=window["webpackJsonp"]=window["webpackJsonp"]||[],r=o.push.bind(o);o.push=t,o=o.slice();for(var c=0;c<o.length;c++)t(o[c]);var u=r;_.push([0,"chunk-vendors"]),s()})({0:function(e,t,s){e.exports=s("56d7")},"0345":function(e,t,s){"use strict";function i(e){var t=wps.WpsApplication().ActiveDocument.Tables.Item(e[0]+1).Cell(e[1][0],e[1][1]).Tables.Item(1);t.Columns.Item(e[3][1]).Select()}s.d(t,"a",function(){return i})},"07bb":function(e,t,s){},"199c":function(module,__webpack_exports__,__webpack_require__){"use strict";var D_01_midi_js_piano_simulator_node_modules_babel_runtime_corejs2_core_js_parse_int__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("e814"),D_01_midi_js_piano_simulator_node_modules_babel_runtime_corejs2_core_js_parse_int__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(D_01_midi_js_piano_simulator_node_modules_babel_runtime_corejs2_core_js_parse_int__WEBPACK_IMPORTED_MODULE_0__),core_js_modules_es7_array_includes__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("6762"),core_js_modules_es7_array_includes__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(core_js_modules_es7_array_includes__WEBPACK_IMPORTED_MODULE_1__),core_js_modules_es6_string_includes__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("2fdb"),core_js_modules_es6_string_includes__WEBPACK_IMPORTED_MODULE_2___default=__webpack_require__.n(core_js_modules_es6_string_includes__WEBPACK_IMPORTED_MODULE_2__),core_js_modules_es6_number_constructor__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("c5f6"),core_js_modules_es6_number_constructor__WEBPACK_IMPORTED_MODULE_3___default=__webpack_require__.n(core_js_modules_es6_number_constructor__WEBPACK_IMPORTED_MODULE_3__),core_js_modules_es6_array_iterator__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("cadf"),core_js_modules_es6_array_iterator__WEBPACK_IMPORTED_MODULE_4___default=__webpack_require__.n(core_js_modules_es6_array_iterator__WEBPACK_IMPORTED_MODULE_4__),core_js_modules_es6_promise__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("551c"),core_js_modules_es6_promise__WEBPACK_IMPORTED_MODULE_5___default=__webpack_require__.n(core_js_modules_es6_promise__WEBPACK_IMPORTED_MODULE_5__),core_js_modules_es7_promise_finally__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("097d"),core_js_modules_es7_promise_finally__WEBPACK_IMPORTED_MODULE_6___default=__webpack_require__.n(core_js_modules_es7_promise_finally__WEBPACK_IMPORTED_MODULE_6__),_public_js_libs_keyMap_js__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("6622"),_public_js_libs_4wps_js__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__("0345");__webpack_exports__["a"]={data:function(){return{loading:0,loadingDone:!1,progress:0,timer:null,totalTime:0,startTime:0,activeKeys:{},noteBefore:-1,pullDown:!1,keyDown:[],PlayStatus:0,pauseLong:0,pauseTime:0,MuscrTimer:null}},watch:{selectedSong:function(){}},methods:{initTimer:function(){var e=this;this.startTime=+new Date,this.totalTime=MIDI.Player.endTime,this.timer=setInterval(function(){if(2!=e.PlayStatus){var t=new Date-e.startTime-e.pauseLong;if(t/e.totalTime>=1)return e.stopTimer(),e.PlayStatus=0,void wps.PluginStorage.setItem("MSEcommand","pianoFinish");e.progress=100*t/e.totalTime+"%"}},20)},stopTimer:function(){var e=this.timer;clearInterval(e),this.MuscrTimer=null,this.progress=0},activate:function(e){var t=this;e=Number(e),this.activeKeys[e]?(this.deactivate(e),this.$nextTick(function(){setTimeout(function(){t.$set(t.activeKeys,e,!0)},20)})):this.$set(this.activeKeys,e,!0)},deactivate:function(e){e=Number(e),this.$delete(this.activeKeys,e)},mousedownEvent:function(e){e&&(e="number"==typeof e?e:e.value,this.activate(e),this.pullDown=!0,this.noteBefore=Number(e),MIDI.noteOn(0,Number(e)+20,200,.005))},mouseupEvent:function(e){e||(e=this.noteBefore),e="number"==typeof e?e:e.value,this.deactivate(e),this.pullDown=!1},mousemoveEvent:function(e){e&&this.pullDown&&(e=Number(e.value),this.noteBefore!=e&&(this.mouseupEvent(this.noteBefore),this.mousedownEvent(e)))},keydownEvent:function(e){if(!this.keyDown.includes(e)){this.keyDown.push(e);var t=Object(_public_js_libs_keyMap_js__WEBPACK_IMPORTED_MODULE_7__["a"])(e);MIDI.noteOn(0,t,200,.005),this.activate(t-20)}},keyupEvent:function(e){this.keyDown.includes(e)&&(this.keyDown.remove(this.keyDown.indexOf(e)),this.deactivate(Object(_public_js_libs_keyMap_js__WEBPACK_IMPORTED_MODULE_7__["a"])(e)-20))},play:function(){var e=this,t=wps.PluginStorage.getItem("midiUrl"),s=MIDI.Player;s.timeWarp=1,2==this.PlayStatus?(s.start(),this.pauseLong=this.pauseLong+(new Date-this.pauseTime)):0==this.PlayStatus&&(this.startTime=0,this.pauseTime=0,this.pauseLong=0,this.stopTimer(),s.stop(),s.wpsLoadFile(t,function(){s.start(),e.initTimer()})),this.PlayStatus=1},pause:function(){var e=MIDI.Player;e.pause(),this.PlayStatus=2,this.pauseTime=new Date},stop:function(){var e=this;this.stopTimer();var t=MIDI.Player;t.stop(),this.PlayStatus=0,setTimeout(function(){e.stopTimer()},100)},playMuscr:function(){2==this.PlayStatus?this.pauseLong=this.pauseLong+(new Date-this.pauseTime):0==this.PlayStatus&&(this.startTime=0,this.pauseTime=0,this.pauseLong=0,this.stopTimer(),this.initMuscrTimer()),this.PlayStatus=1},initMuscrTimer:function initMuscrTimer(){var app=wps.WpsApplication();app.ScreenUpdating=!0;var pianoObj=wps.PluginStorage.getItem("pianoObj");pianoObj=eval("("+pianoObj+")");var TrackObj=pianoObj.TrackObj;this.startTime=+new Date,this.totalTime=pianoObj.total;var haspassedTime=0,p=0;this.MuscrTimer=function(){var e=this;setTimeout(function(){if(e.MuscrTimer&&e.MuscrTimer(),2!=e.PlayStatus){if(haspassedTime+=20,p<TrackObj.length&&haspassedTime>=TrackObj[p].t){var t=TrackObj[p].code;-1!=t&&(MIDI.noteOn(0,t,200,.005),e.keyDown.push(t),Object(_public_js_libs_4wps_js__WEBPACK_IMPORTED_MODULE_8__["a"])(TrackObj[p].addr),e.activate(t-20),setTimeout(function(){e.keyDown.includes(t)&&(e.keyDown.remove(e.keyDown.indexOf(t)),e.deactivate(t-20))},TrackObj[p].long/1.1)),p+=1}if(haspassedTime/e.totalTime>=1)return e.stopTimer(),e.PlayStatus=0,app.ActiveDocument.Select(),app.ActiveWindow.Selection.EndKey(),void wps.PluginStorage.setItem("MSEcommand","pianoFinish");e.progress=100*haspassedTime/e.totalTime+"%"}},20)},this.MuscrTimer()}},created:function(){},mounted:function(){var e=this,t=this;MIDI.loadPlugin({soundfontUrl:"./soundfont/",instrument:"acoustic_grand_piano",onprogress:function(e,s){t.loading=D_01_midi_js_piano_simulator_node_modules_babel_runtime_corejs2_core_js_parse_int__WEBPACK_IMPORTED_MODULE_0___default()(100*s),1==s&&"load"==e&&(t.loadingDone=!0)},onsuccess:function(){var e=MIDI.Player;e.addListener(function(e){144===e.message&&t.activate(e.note-20),128===e.message&&t.deactivate(e.note-20)})}});var s=function t(){setTimeout(function(){t();var s=wps.PluginStorage.getItem("pianoCommand");if(s)switch(i(),console.log("command =",s),s){case"play":e.play();break;case"pause":e.pause();break;case"stop":e.stop();break;case"playMuscr":e.playMuscr();break}},369)};function i(){wps.PluginStorage.setItem("pianoCommand",null)}s(),Array.prototype.remove=function(e,t){var s=this.slice((t||e)+1||this.length);return this.length=e<0?this.length+e:e,this.push.apply(this,s)}}}},"56d7":function(e,t,s){"use strict";s.r(t);s("cadf"),s("551c"),s("097d");var i=s("2b0e"),a=s("eec4"),_=s.n(a),n=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{attrs:{id:"app",tabIndex:"0"},on:{keydown:function(t){e.keydownEvent(t.code)},keyup:function(t){e.keyupEvent(t.code)}}},[e.loadingDone?e._e():s("div",{staticClass:"loading"},[e._v("\n    loading resources... "+e._s(e.loading)+"%\n  ")]),s("div",{staticClass:"progress"},[s("div",{staticClass:"bar",style:{width:e.progress}})]),s("div",{staticClass:"piano",on:{mousedown:function(t){e.mousedownEvent(t.target.attributes.note)},mouseup:function(t){e.mouseupEvent(t.target.attributes.note)},mousemove:function(t){e.mousemoveEvent(t.target.attributes.note)}}},[s("div",{staticClass:"octave first"},[s("div",{staticClass:"white",class:{active:e.activeKeys[1]},attrs:{note:1}}),s("span",{staticClass:"black",class:{active:e.activeKeys[2]},attrs:{note:2}}),s("div",{staticClass:"white",class:{active:e.activeKeys[3]},attrs:{note:3}})]),e._l(7,function(t){return s("div",{key:t,staticClass:"octave"},[s("div",{staticClass:"white",class:{active:e.activeKeys[12*(t-1)+4]},attrs:{note:12*(t-1)+4}}),s("span",{staticClass:"black",class:{active:e.activeKeys[12*(t-1)+5]},attrs:{note:12*(t-1)+5}}),s("div",{staticClass:"white",class:{active:e.activeKeys[12*(t-1)+6]},attrs:{note:12*(t-1)+6}}),s("span",{staticClass:"black",class:{active:e.activeKeys[12*(t-1)+7]},attrs:{note:12*(t-1)+7}}),s("div",{staticClass:"white",class:{active:e.activeKeys[12*(t-1)+8]},attrs:{note:12*(t-1)+8}}),s("div",{staticClass:"white",class:{active:e.activeKeys[12*(t-1)+9]},attrs:{note:12*(t-1)+9}}),s("span",{staticClass:"black",class:{active:e.activeKeys[12*(t-1)+10]},attrs:{note:12*(t-1)+10}}),s("div",{staticClass:"white",class:{active:e.activeKeys[12*(t-1)+11]},attrs:{note:12*(t-1)+11}}),s("span",{staticClass:"black",class:{active:e.activeKeys[12*(t-1)+12]},attrs:{note:12*(t-1)+12}}),s("div",{staticClass:"white",class:{active:e.activeKeys[12*(t-1)+13]},attrs:{note:12*(t-1)+13}}),s("span",{staticClass:"black",class:{active:e.activeKeys[12*(t-1)+14]},attrs:{note:12*(t-1)+14}}),s("div",{staticClass:"white",class:{active:e.activeKeys[12*(t-1)+15]},attrs:{note:12*(t-1)+15}})])}),s("div",{staticClass:"octave last"},[s("div",{staticClass:"white",class:{active:e.activeKeys[88]},attrs:{note:88}})])],2),s("div",{staticClass:"version"},[e._v("piano for wps")])])},o=[],r=s("199c"),c=r["a"],u=(s("7faf"),s("b0a0"),s("2877")),l=Object(u["a"])(c,n,o,!1,null,"71f0b687",null);l.options.__file="App.vue";var p=l.exports,d=s("8c4f");i["a"].use(d["a"]);new d["a"]({routes:[]});var m=s("2f62");i["a"].use(m["a"]);new m["a"].Store({state:{},mutations:{},actions:{}});i["a"].config.productionTip=!1,new i["a"]({render:function(e){return e(p)},mounted:function(){var e=_()();e.listenTo(document.getElementsByClassName("piano"),function(e){var t=e.offsetWidth/e.offsetHeight,s=wps.GetTaskPane(1);t&&s.Height&&(s.Height=s.Width/t+36)})}}).$mount("#app")},6622:function(e,t,s){"use strict";s.d(t,"a",function(){return a});var i={Backquote:0,Digit1:0,Digit2:61,Digit3:63,Digit4:0,Digit5:66,Digit6:68,Digit7:70,Digit8:0,Digit9:73,Digit0:75,Minus:0,Equal:78,Backspace:0,KeyQ:60,KeyW:62,KeyE:64,KeyR:65,KeyT:67,KeyY:69,KeyU:71,KeyI:72,KeyO:74,KeyP:76,BracketLeft:77,BracketRight:79,Backslash:0,KeyA:0,KeyS:49,KeyD:51,KeyF:0,KeyG:54,KeyH:56,KeyJ:58,KeyK:0,KeyL:61,Semicolon:63,Quote:0,KeyZ:48,KeyX:50,KeyC:52,KeyV:53,KeyB:55,KeyN:57,KeyM:59,Comma:60,Period:62,Slash:64};function a(e){return i[e]}},"7faf":function(e,t,s){"use strict";var i=s("aea6"),a=s.n(i);a.a},aea6:function(e,t,s){},b0a0:function(e,t,s){"use strict";var i=s("07bb"),a=s.n(i);a.a}});
//# sourceMappingURL=app.ec54f340.js.map